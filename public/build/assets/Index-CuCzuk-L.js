import{s as Y,A as oe,E as F,g as d,w as c,i as a,j as t,bI as re,X as ne,bJ as le,bK as de,bL as ce,y as ie,bM as ue,R as me,r as h,W as fe,u as pe,C as A,a1 as _e,f as i,l as o,at as W,n as v,F as H,m as T,K as V,t as f,aG as he,q as w,G as ve,bN as ge,bB as be,be as xe,bg as ye}from"./vendor-BwD25tKZ.js";import{d as q,_ as I,a as M,b as N,c as we}from"./constructNow-B9pLeBHj.js";import{_ as B}from"./Input.vue_vue_type_script_setup_true_lang-CECQSOSU.js";import{_ as k}from"./index-CKGAZWQo.js";import{c as ke}from"./utils-CBfrqCZ4.js";import{t as Ce,c as L,n as De,s as G,f as j}from"./format-BcfG6MxF.js";import"./charts-DOEJufVb.js";import"./useForwardExpose-G3tvssmS.js";import"./Primitive-BSXjhaNq.js";import"./createContext-BqFVO7-m.js";function $e(n,l,u){const m=Ce(n,u?.in);return isNaN(l)?L(n,NaN):(m.setDate(m.getDate()+l),m)}function J(n,l,u){const[m,g]=De(u?.in,n,l);return+G(m)==+G(g)}function Ae(n,l){return J(L(n,n),q(n))}function Ve(n,l,u){return $e(n,-1,u)}function Ie(n,l){return J(L(n,n),Ve(q(n)))}const X=Y({__name:"ScrollArea",props:{type:{},dir:{},scrollHideDelay:{},asChild:{type:Boolean},as:{},class:{}},setup(n){const l=n,u=oe(()=>{const{class:m,...g}=l;return g});return(m,g)=>(d(),F(t(ue),ie(u.value,{class:t(ke)("relative overflow-hidden",l.class)}),{default:c(()=>[a(t(re),{class:"h-full w-full rounded-[inherit]"},{default:c(()=>[ne(m.$slots,"default")]),_:3}),a(t(le),{class:"flex touch-none select-none border-l border-l-transparent p-[1px] transition-colors duration-200 ease-out data-[orientation=vertical]:w-2.5 data-[orientation=horizontal]:h-2.5 data-[orientation=horizontal]:flex-col"},{default:c(()=>[a(t(de),{class:"relative flex-1 rounded-full bg-border"})]),_:1}),a(t(ce))]),_:3},16,["class"]))}}),C=h([]);let Me=0;function Ne(){const n=l=>{const u=`toast-${Me++}`;C.value.push({...l,id:u}),setTimeout(()=>{C.value=C.value.filter(m=>m.id!==u)},5e3)};return me(()=>{C.value=[]}),{toasts:C,toast:n}}const Se={class:"flex h-[calc(100vh-4rem)] bg-background"},ze={class:"w-1/4 border-r bg-card dark:border-border flex flex-col"},Be={class:"p-4 border-b dark:border-border"},je={class:"mt-4 flex items-center space-x-2"},Fe={class:"divide-y dark:divide-border"},Le=["onClick"],Pe={class:"flex items-center space-x-3"},Ee={class:"font-medium text-foreground"},Re={class:"text-sm text-muted-foreground"},Ke={class:"flex-grow flex flex-col bg-background"},Ue={key:0,class:"p-4 border-b dark:border-border flex justify-between items-center"},We={class:"flex items-center space-x-3"},He={class:"font-medium text-foreground"},Te={class:"text-sm text-muted-foreground"},Ge={key:1,class:"p-4 border-b dark:border-border"},Xe={class:"space-y-6"},Ye={key:0,class:"text-sm"},qe={key:1,class:"mt-2"},Je=["innerHTML"],Oe={key:0,class:"ml-1"},Qe={key:1,class:"ml-1"},Ze={key:2,class:"p-4 border-t dark:border-border"},et={key:0,class:"mb-2 p-2 border rounded-md bg-accent flex items-center justify-between"},tt={class:"flex items-center gap-2"},st=["src"],at={key:1,class:"text-xl"},ot={class:"relative"},rt={class:"absolute inset-y-0 right-0 flex items-center"},nt={for:"attachment-input",class:"cursor-pointer p-2"},lt={key:3,class:"p-4 border-t dark:border-border text-center text-muted-foreground"},dt=Y({__name:"Index",props:{auth:{},conversations:{},selectedConversation:{},messages:{},filters:{}},setup(n){const l=n,u=fe(),{toast:m}=Ne(),g=h(l.conversations),p=h(l.selectedConversation),P=h(l.messages),D=h(""),x=h(null),y=h(null),S=h(null),z=h(l.filters.search||""),_=pe({receiver_id:p.value?.id||null,message:"",attachment:null});A(()=>l.conversations,e=>{g.value=e}),A(()=>l.selectedConversation,e=>{p.value=e,_.receiver_id=e?.id||null}),A(()=>l.messages,e=>{P.value=e,_e(O)}),A(D,e=>{_.message=e});const O=()=>{S.value&&S.value.scrollIntoView({behavior:"smooth"})},Q=e=>{window.location.href=route("admin.messages.index",e)},Z=e=>{const r=e.target;if(r.files&&r.files[0]){const s=r.files[0];if(x.value=s,_.attachment=s,s.type.startsWith("image/")){const $=new FileReader;$.onload=ae=>{y.value=ae.target?.result},$.readAsDataURL(s)}else y.value=null}else x.value=null,_.attachment=null,y.value=null},E=()=>{x.value=null,_.attachment=null,y.value=null;const e=document.getElementById("attachment-input");e&&(e.value="")},R=()=>{if(!_.message&&!_.attachment){m({title:"Cannot send empty message",description:"Please type a message or attach a file.",variant:"destructive"});return}_.post(route("admin.messages.store"),{preserveScroll:!0,onSuccess:()=>{D.value="",E(),window.location.href=route("admin.messages.index",p.value?.id)},onError:e=>{console.error("Message send error:",e),m({title:"Failed to send message",description:e.message||"An unknown error occurred.",variant:"destructive"})}})},ee=e=>{const r=new Date(e);return Ae(r)?j(r,"p"):Ie(r)?"Yesterday "+j(r,"p"):j(r,"MMM d, yyyy p")},b=e=>e.sender_id===u.props.auth.user.id,te=e=>{window.open(route("admin.messages.download",e),"_blank")},K=()=>{window.location.href=route("admin.messages.index",{search:z.value})},U=e=>e?e.startsWith("image/")?"🖼️":e.includes("pdf")?"📄":e.includes("wordprocessingml")||e.includes("msword")?"📝":e.includes("spreadsheetml")||e.includes("excel")?"📊":e.includes("text/plain")?"📄":"📎":"📎",se=e=>e.attachment_mime_type?.startsWith("image/")?`<img src="${e.attachment_url}" alt="${e.attachment_filename}" class="max-w-xs max-h-48 rounded-lg object-cover" />`:`<div class="flex items-center gap-2 p-2 border rounded-md bg-gray-50 dark:bg-gray-700">
            <span class="text-xl">${U(e.attachment_mime_type)}</span>
            <span>${e.attachment_filename}</span>
          </div>`;return(e,r)=>(d(),i("div",Se,[o("div",ze,[o("div",Be,[r[3]||(r[3]=o("h2",{class:"text-xl font-semibold text-foreground"},"Conversations",-1)),o("div",je,[a(t(B),{modelValue:z.value,"onUpdate:modelValue":r[0]||(r[0]=s=>z.value=s),placeholder:"Search users...",class:"shadow-sm bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-cyan-600 focus:border-cyan-600 block w-full p-2.5",onKeyup:W(K,["enter"])},null,8,["modelValue"]),a(t(k),{onClick:K},{default:c(()=>[...r[2]||(r[2]=[v("Search",-1)])]),_:1})])]),a(t(X),{class:"flex-grow overflow-y-auto"},{default:c(()=>[o("ul",Fe,[(d(!0),i(H,null,T(g.value,s=>(d(),i("li",{key:s.id,class:V(["p-4 cursor-pointer hover:bg-accent",{"bg-primary/10":p.value&&p.value.id===s.id}]),onClick:$=>Q(s.id)},[o("div",Pe,[a(t(I),null,{default:c(()=>[a(t(M),{src:s.profile_photo_url,alt:s.name},null,8,["src","alt"]),a(t(N),null,{default:c(()=>[v(f(s.name.charAt(0)),1)]),_:2},1024)]),_:2},1024),o("div",null,[o("p",Ee,f(s.name),1),o("p",Re,f(s.email),1)])])],10,Le))),128))])]),_:1})]),o("div",Ke,[p.value?(d(),i("div",Ue,[o("div",We,[a(t(I),null,{default:c(()=>[a(t(M),{src:p.value.profile_photo_url,alt:p.value.name},null,8,["src","alt"]),a(t(N),null,{default:c(()=>[v(f(p.value.name.charAt(0)),1)]),_:1})]),_:1}),o("div",null,[o("p",He,f(p.value.name),1),o("p",Te,f(p.value.email),1)])]),a(t(k),{variant:"ghost",size:"icon"},{default:c(()=>[a(t(he),{class:"h-5 w-5"})]),_:1})])):(d(),i("div",Ge,[...r[4]||(r[4]=[o("h2",{class:"text-xl font-semibold text-foreground"}," Select a Conversation ",-1)])])),a(t(X),{class:"flex-grow p-6 overflow-y-auto custom-scrollbar"},{default:c(()=>[o("div",Xe,[(d(!0),i(H,null,T(P.value,s=>(d(),i("div",{key:s.id,class:V(["flex items-end gap-2",b(s)?"justify-end":"justify-start"])},[b(s)?w("",!0):(d(),F(t(I),{key:0,class:"h-8 w-8"},{default:c(()=>[a(t(M),{src:s.sender.profile_photo_url,alt:s.sender.name},null,8,["src","alt"]),a(t(N),null,{default:c(()=>[v(f(s.sender.name.charAt(0)),1)]),_:2},1024)]),_:2},1024)),o("div",{class:V(["max-w-lg p-3 rounded-2xl",b(s)?"bg-primary text-primary-foreground rounded-br-none":"bg-secondary text-secondary-foreground rounded-bl-none"])},[s.message?(d(),i("div",Ye,f(s.message),1)):w("",!0),s.attachment_path?(d(),i("div",qe,[o("div",{innerHTML:se(s)},null,8,Je),a(t(k),{variant:"link",class:"text-xs p-0 h-auto mt-1",onClick:$=>te(s.id)},{default:c(()=>[a(t(ve),{class:"h-3 w-3 mr-1"}),v(" Download "+f(s.attachment_filename),1)]),_:2},1032,["onClick"])])):w("",!0),o("div",{class:V(["text-xs mt-1",b(s)?"text-primary-foreground/70":"text-muted-foreground"])},[v(f(ee(s.created_at))+" ",1),b(s)&&s.read_at?(d(),i("span",Oe,[a(t(ge),{class:"h-3 w-3 inline-block"})])):b(s)?(d(),i("span",Qe,[a(t(be),{class:"h-3 w-3 inline-block"})])):w("",!0)],2)],2),b(s)?(d(),F(t(I),{key:1,class:"h-8 w-8"},{default:c(()=>[a(t(M),{src:t(u).props.auth.user.profile_photo_url,alt:t(u).props.auth.user.name},null,8,["src","alt"]),a(t(N),null,{default:c(()=>[v(f(t(u).props.auth.user.name.charAt(0)),1)]),_:1})]),_:1})):w("",!0)],2))),128)),o("div",{ref_key:"messagesEndRef",ref:S},null,512)])]),_:1}),p.value?(d(),i("div",Ze,[y.value?(d(),i("div",et,[o("div",tt,[x.value?.type.startsWith("image/")?(d(),i("img",{key:0,src:y.value,class:"h-16 w-16 object-cover rounded-md"},null,8,st)):(d(),i("span",at,f(U(x.value?.type||"")),1)),o("span",null,f(x.value?.name),1)]),a(t(k),{variant:"ghost",size:"sm",onClick:E},{default:c(()=>[...r[5]||(r[5]=[v("X",-1)])]),_:1})])):w("",!0),o("div",ot,[a(t(B),{modelValue:D.value,"onUpdate:modelValue":r[1]||(r[1]=s=>D.value=s),placeholder:"Type your message...",class:"pr-20",onKeyup:W(R,["enter"])},null,8,["modelValue"]),o("div",rt,[o("label",nt,[a(t(xe),{class:"h-5 w-5 text-muted-foreground hover:text-foreground"}),a(t(B),{id:"attachment-input",type:"file",class:"hidden",onChange:Z})]),a(t(k),{onClick:R,disabled:t(_).processing,size:"icon",class:"mr-2"},{default:c(()=>[a(t(ye),{class:"h-5 w-5"})]),_:1},8,["disabled"])])])])):(d(),i("div",lt," Select a conversation to start messaging. "))])]))}}),bt=we(dt,[["__scopeId","data-v-68373cc7"]]);export{bt as default};
