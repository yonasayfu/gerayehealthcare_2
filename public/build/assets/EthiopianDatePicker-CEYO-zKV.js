import{r as v,A as $,C as x,o as H,bP as O,f as p,g as m,l as u,q as C,p as V,B as N,F as b,m as w,t as k,K as R}from"./vendor-BwD25tKZ.js";import{u as q}from"./useEthiopianDate-D2L2aCHH.js";import{c as A}from"./constructNow-B9pLeBHj.js";const K=["value"],W={key:1,class:"absolute z-10 bg-white border border-gray-300 rounded-lg shadow-lg mt-1 p-4"},J={class:"flex justify-between items-center mb-2"},Q=["value"],X=["value"],Z={class:"grid grid-cols-7 text-center text-xs font-medium text-gray-500 mb-1"},ee={class:"grid grid-cols-7 gap-1 text-sm"},te=["onClick"],ae={__name:"EthiopianDatePicker",props:{modelValue:String},emits:["update:modelValue","update:ethiopianDate"],setup(G,{emit:_}){const E=G,l=_,g=v(!1),o=v(""),{convertGregorianToEthiopian:y,convertEthiopianToGregorian:f}=q(),d=v(null),s=v(null),T=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],F=["Meskerem","Tekemt","Hidar","Tahsas","Ter","Yekatit","Megabit","Miazia","Genbot","Sene","Hamle","Nehase","Pagume"],P=$(()=>{if(!o.value)return"";const[t,a,e]=o.value.split("-").map(Number);return`${t}-${String(a).padStart(2,"0")}-${String(e).padStart(2,"0")}`});$(()=>s.value?F[s.value-1]:"");const B=$(()=>{const t=d.value||new Date().getFullYear()-7,a=[];for(let e=t-10;e<=t+10;e++)a.push(e);return a}),h=v([]);x([d,s],async()=>{try{if(d.value===null||s.value===null){h.value=[];return}const t=[],a=await f({year:d.value,month:s.value,day:1});if(!a){h.value=[];return}let n=new Date(a.year,a.month-1,a.day).getDay();n=n===0?6:n-1;for(let i=0;i<n;i++)t.push({date:null});let r;if(s.value===13){const i=await f({year:d.value+1,month:1,day:1});if(!i){h.value=[];return}const D=new Date(i.year,i.month-1,i.day),c=new Date(D.setDate(D.getDate()-1)),Y=await y({year:c.getFullYear(),month:c.getMonth()+1,day:c.getDate()});if(!Y){h.value=[];return}r=Y.day}else r=30;for(let i=1;i<=r;i++)t.push({date:i,month:s.value,year:d.value});h.value=t}catch(t){console.error("Error in updateCalendarDays:",t)}},{immediate:!0});async function L(t){if(t.date){o.value=`${t.year}-${t.month}-${t.date}`,g.value=!1;const a=await f({year:t.year,month:t.month,day:t.date});if(a){const e=`${a.year}-${String(a.month).padStart(2,"0")}-${String(a.day).padStart(2,"0")}`;l("update:modelValue",e),l("update:ethiopianDate",o.value)}else console.error("Failed to convert Ethiopian date to Gregorian.")}}function I(t){if(!o.value||!t.date)return!1;const[a,e,n]=o.value.split("-").map(Number);return t.year===a&&t.month===e&&t.date===n}async function z(t){if(!t.date)return!1;const a=new Date,e=await y({year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate()});return e?t.year===e.year&&t.month===e.month&&t.date===e.day:!1}async function U(t){const a=t.target.value;o.value=a;const e=a.split("-").map(Number);if(e.length===3&&!isNaN(e[0])&&!isNaN(e[1])&&!isNaN(e[2]))try{const n=await f({year:e[0],month:e[1],day:e[2]});if(n){const r=`${n.year}-${String(n.month).padStart(2,"0")}-${String(n.day).padStart(2,"0")}`;l("update:modelValue",r),l("update:ethiopianDate",a)}else l("update:modelValue",""),l("update:ethiopianDate",a),console.error("Failed to convert Ethiopian date to Gregorian from input.")}catch{l("update:modelValue",""),l("update:ethiopianDate",a)}else l("update:modelValue",""),l("update:ethiopianDate",null),console.log("Emitting null ethiopianDate from input due to invalid format or empty value",a)}x(o,t=>{t===""&&l("update:ethiopianDate",null)});const M=v(null),S=t=>{M.value&&!M.value.contains(t.target)&&(g.value=!1)};H(async()=>{const t=new Date;let a=t.getFullYear()-7,e=1;const n=await y({year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate()});if(n?(a=n.year,e=n.month):console.warn("Failed to get today's Ethiopian date, using approximate default."),d.value=a,s.value=e,E.modelValue){const[r,i,D]=E.modelValue.split("-").map(Number),c=await y({year:r,month:i,day:D});c?(o.value=`${c.year}-${c.month}-${c.day}`,d.value=c.year,s.value=c.month):(o.value="",console.error("Failed to convert modelValue Gregorian date to Ethiopian."))}else n?o.value=`${n.year}-${n.month}-${n.day}`:o.value=`${a}-${e}-1`;document.addEventListener("click",S)}),O(()=>{document.removeEventListener("click",S)}),x(()=>E.modelValue,async t=>{if(t){const[a,e,n]=t.split("-").map(Number),r=await y({year:a,month:e,day:n});r&&(o.value=`${r.year}-${r.month}-${r.day}`,d.value=r.year,s.value=r.month)}else o.value=""});function j(){o.value="",l("update:modelValue",null),l("update:ethiopianDate",null)}return(t,a)=>(m(),p("div",{class:"relative",ref_key:"datePickerRef",ref:M},[u("input",{type:"text",value:P.value,onFocus:a[0]||(a[0]=e=>g.value=!0),onInput:U,placeholder:"YYYY-MM-DD",class:"shadow-sm bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-cyan-600 focus:border-cyan-600 block w-full p-2.5 pr-10"},null,40,K),o.value?(m(),p("button",{key:0,onClick:j,class:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 focus:outline-none","aria-label":"Clear date"},[...a[5]||(a[5]=[u("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])):C("",!0),g.value?(m(),p("div",W,[u("div",J,[u("button",{onClick:a[1]||(a[1]=(...e)=>t.prevMonth&&t.prevMonth(...e)),class:"px-2 py-1 rounded hover:bg-gray-200"},"<"),V(u("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>s.value=e),class:"mx-2 p-1 border rounded"},[(m(),p(b,null,w(F,(e,n)=>u("option",{key:n,value:n+1},k(e),9,Q)),64))],512),[[N,s.value]]),V(u("select",{"onUpdate:modelValue":a[3]||(a[3]=e=>d.value=e),class:"mx-2 p-1 border rounded"},[(m(!0),p(b,null,w(B.value,e=>(m(),p("option",{key:e,value:e},k(e),9,X))),128))],512),[[N,d.value]]),u("button",{onClick:a[4]||(a[4]=(...e)=>t.nextMonth&&t.nextMonth(...e)),class:"px-2 py-1 rounded hover:bg-gray-200"},">")]),u("div",Z,[(m(),p(b,null,w(T,e=>u("span",{key:e},k(e),1)),64))]),u("div",ee,[(m(!0),p(b,null,w(h.value,(e,n)=>(m(),p("span",{key:n,class:R(["p-1 text-center rounded cursor-pointer",{"text-gray-400":!e.date,"hover:bg-cyan-100":e.date,"bg-cyan-500 text-white":I(e),"font-bold":z(e)}]),onClick:r=>L(e)},k(e.date?e.date:""),11,te))),128))])])):C("",!0)],512))}},ie=A(ae,[["__scopeId","data-v-d47c5eba"]]);export{ie as E};
