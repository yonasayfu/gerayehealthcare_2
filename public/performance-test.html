<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frontend Performance Analyzer</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
        }
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f1f5f9;
        }
        .metric:last-child {
            border-bottom: none;
        }
        .value {
            font-weight: bold;
        }
        .good { color: #10b981; }
        .warning { color: #f59e0b; }
        .error { color: #ef4444; }
        .loading {
            color: #6b7280;
            font-style: italic;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button:hover {
            background: #2563eb;
        }
        .recommendations {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 6px;
            padding: 15px;
            margin-top: 20px;
        }
        .log {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .progress {
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            height: 6px;
            margin: 10px 0;
        }
        .progress-bar {
            background: #3b82f6;
            height: 100%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Frontend Performance Analyzer</h1>
        <p>Comprehensive analysis tool to diagnose Laravel + Inertia.js + Vue 3 performance issues</p>
        
        <div style="margin-bottom: 20px;">
            <button onclick="runFullAnalysis()">üîç Run Full Analysis</button>
            <button onclick="testPageLoad()">‚è±Ô∏è Test Page Load</button>
            <button onclick="testNetworkSpeed()">üåê Test Network</button>
            <button onclick="clearResults()">üóëÔ∏è Clear Results</button>
        </div>
        
        <div class="progress" id="progressContainer" style="display: none;">
            <div class="progress-bar" id="progressBar" style="width: 0%;"></div>
        </div>
        
        <div class="section">
            <h2>üìä Performance Metrics</h2>
            <div class="metric">
                <span>DOM Content Loaded</span>
                <span class="value loading" id="domContentLoaded">Measuring...</span>
            </div>
            <div class="metric">
                <span>Full Page Load</span>
                <span class="value loading" id="fullPageLoad">Measuring...</span>
            </div>
            <div class="metric">
                <span>First Paint (FP)</span>
                <span class="value loading" id="firstPaint">Measuring...</span>
            </div>
            <div class="metric">
                <span>First Contentful Paint (FCP)</span>
                <span class="value loading" id="firstContentfulPaint">Measuring...</span>
            </div>
            <div class="metric">
                <span>Largest Contentful Paint (LCP)</span>
                <span class="value loading" id="largestContentfulPaint">Measuring...</span>
            </div>
            <div class="metric">
                <span>JavaScript Bundle Size</span>
                <span class="value loading" id="bundleSize">Calculating...</span>
            </div>
        </div>
        
        <div class="section">
            <h2>üåê Network Analysis</h2>
            <div class="metric">
                <span>Backend Response Time</span>
                <span class="value loading" id="backendResponse">Testing...</span>
            </div>
            <div class="metric">
                <span>Asset Loading Time</span>
                <span class="value loading" id="assetLoading">Analyzing...</span>
            </div>
            <div class="metric">
                <span>Total Network Requests</span>
                <span class="value loading" id="totalRequests">Counting...</span>
            </div>
            <div class="metric">
                <span>Failed Requests</span>
                <span class="value loading" id="failedRequests">Checking...</span>
            </div>
        </div>
        
        <div class="section">
            <h2>‚ö° JavaScript Performance</h2>
            <div class="metric">
                <span>Vue.js Initialization</span>
                <span class="value loading" id="vueInit">Measuring...</span>
            </div>
            <div class="metric">
                <span>Component Mount Time</span>
                <span class="value loading" id="componentMount">Measuring...</span>
            </div>
            <div class="metric">
                <span>Memory Usage</span>
                <span class="value loading" id="memoryUsage">Calculating...</span>
            </div>
        </div>
        
        <div class="section">
            <h2>üîç Detailed Analysis</h2>
            <div class="log" id="analysisLog">Ready to run analysis...

Click 'Run Full Analysis' to start comprehensive performance testing.</div>
        </div>
        
        <div class="recommendations" id="recommendations" style="display: none;">
            <h3>üí° Performance Recommendations</h3>
            <ul id="recommendationsList"></ul>
        </div>
    </div>
    
    <script>
        let startTime = performance.now();
        let analysisResults = {};
        
        // Measure initial page load metrics
        window.addEventListener('load', () => {
            setTimeout(measurePerformance, 100);
        });
        
        async function runFullAnalysis() {
            showProgress();
            updateProgress(0);
            log('üöÄ Starting comprehensive performance analysis...');
            
            try {
                updateProgress(10);
                await testBackendPerformance();
                
                updateProgress(30);
                await testNetworkPerformance();
                
                updateProgress(50);
                await testAssetSizes();
                
                updateProgress(70);
                await measureWebVitals();
                
                updateProgress(90);
                generateRecommendations();
                
                updateProgress(100);
                log('‚úÖ Analysis complete!');
                hideProgress();
            } catch (error) {
                log(`‚ùå Analysis error: ${error.message}`);
                hideProgress();
            }
        }
        
        async function testBackendPerformance() {
            log('üîç Testing backend performance...');
            const start = performance.now();
            
            try {
                const response = await fetch('/performance-test');
                const end = performance.now();
                const data = await response.json();
                
                const responseTime = end - start;
                document.getElementById('backendResponse').textContent = `${responseTime.toFixed(2)}ms`;
                document.getElementById('backendResponse').className = `value ${responseTime < 100 ? 'good' : responseTime < 500 ? 'warning' : 'error'}`;
                
                log(`‚úÖ Backend response: ${responseTime.toFixed(2)}ms`);
                log(`üìä Backend stats: ${data.total_execution_time}, ${data.total_queries} queries, ${data.memory_usage}`);
                
                analysisResults.backendResponse = responseTime;
            } catch (error) {
                log(`‚ùå Backend test failed: ${error.message}`);
                document.getElementById('backendResponse').textContent = 'Failed';
                document.getElementById('backendResponse').className = 'value error';
            }
        }
        
        async function testNetworkPerformance() {
            log('üåê Analyzing network performance...');
            
            // Test asset loading times
            const resourceEntries = performance.getEntriesByType('resource');
            let totalSize = 0;
            let slowestAsset = null;
            let slowestTime = 0;
            
            resourceEntries.forEach(entry => {
                if (entry.transferSize) {
                    totalSize += entry.transferSize;
                }
                
                const loadTime = entry.responseEnd - entry.requestStart;
                if (loadTime > slowestTime) {
                    slowestTime = loadTime;
                    slowestAsset = entry.name;
                }
            });
            
            document.getElementById('assetLoading').textContent = `${slowestTime.toFixed(2)}ms (slowest)`;
            document.getElementById('assetLoading').className = `value ${slowestTime < 200 ? 'good' : slowestTime < 1000 ? 'warning' : 'error'}`;
            
            document.getElementById('totalRequests').textContent = resourceEntries.length;
            document.getElementById('totalRequests').className = `value ${resourceEntries.length < 50 ? 'good' : resourceEntries.length < 100 ? 'warning' : 'error'}`;
            
            const failedCount = resourceEntries.filter(entry => entry.responseStatus >= 400).length;
            document.getElementById('failedRequests').textContent = failedCount;
            document.getElementById('failedRequests').className = `value ${failedCount === 0 ? 'good' : 'error'}`;
            
            log(`üì¶ Total assets: ${resourceEntries.length}, Total size: ${(totalSize / 1024 / 1024).toFixed(2)}MB`);
            log(`üêå Slowest asset: ${slowestAsset} (${slowestTime.toFixed(2)}ms)`);
            
            analysisResults.assetCount = resourceEntries.length;
            analysisResults.slowestAsset = slowestTime;
            analysisResults.totalSize = totalSize;
        }
        
        async function testAssetSizes() {
            log('üìä Calculating bundle sizes...');
            
            try {
                const jsEntries = performance.getEntriesByType('resource')
                    .filter(entry => entry.name.includes('.js'))
                    .map(entry => ({
                        name: entry.name.split('/').pop(),
                        size: entry.transferSize || entry.encodedBodySize || 0,
                        loadTime: entry.responseEnd - entry.requestStart
                    }))
                    .sort((a, b) => b.size - a.size);
                
                let totalJSSize = jsEntries.reduce((sum, entry) => sum + entry.size, 0);
                
                document.getElementById('bundleSize').textContent = `${(totalJSSize / 1024).toFixed(2)}KB`;
                document.getElementById('bundleSize').className = `value ${totalJSSize < 500000 ? 'good' : totalJSSize < 1000000 ? 'warning' : 'error'}`;
                
                log(`üì¶ JavaScript bundle analysis:`);
                jsEntries.slice(0, 5).forEach(entry => {
                    log(`   ${entry.name}: ${(entry.size / 1024).toFixed(2)}KB (${entry.loadTime.toFixed(2)}ms)`);
                });
                
                analysisResults.bundleSize = totalJSSize;
            } catch (error) {
                log(`‚ùå Bundle analysis failed: ${error.message}`);
            }
        }
        
        function measurePerformance() {
            // DOM Content Loaded
            const domContentLoadedTime = performance.timing.domContentLoadedEventEnd - performance.timing.navigationStart;
            document.getElementById('domContentLoaded').textContent = `${domContentLoadedTime}ms`;
            document.getElementById('domContentLoaded').className = `value ${domContentLoadedTime < 1000 ? 'good' : domContentLoadedTime < 3000 ? 'warning' : 'error'}`;
            
            // Full page load
            const fullPageLoadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
            document.getElementById('fullPageLoad').textContent = `${fullPageLoadTime}ms`;
            document.getElementById('fullPageLoad').className = `value ${fullPageLoadTime < 2000 ? 'good' : fullPageLoadTime < 5000 ? 'warning' : 'error'}`;
            
            analysisResults.domContentLoaded = domContentLoadedTime;
            analysisResults.fullPageLoad = fullPageLoadTime;
        }
        
        async function measureWebVitals() {
            log('‚ö° Measuring Core Web Vitals...');
            
            // First Paint
            const paintEntries = performance.getEntriesByType('paint');
            const fpEntry = paintEntries.find(entry => entry.name === 'first-paint');
            const fcpEntry = paintEntries.find(entry => entry.name === 'first-contentful-paint');
            
            if (fpEntry) {
                document.getElementById('firstPaint').textContent = `${fpEntry.startTime.toFixed(2)}ms`;
                document.getElementById('firstPaint').className = `value ${fpEntry.startTime < 1000 ? 'good' : fpEntry.startTime < 2500 ? 'warning' : 'error'}`;
            }
            
            if (fcpEntry) {
                document.getElementById('firstContentfulPaint').textContent = `${fcpEntry.startTime.toFixed(2)}ms`;
                document.getElementById('firstContentfulPaint').className = `value ${fcpEntry.startTime < 1000 ? 'good' : fcpEntry.startTime < 2500 ? 'warning' : 'error'}`;
            }
            
            // Memory usage
            if (performance.memory) {
                const memoryMB = (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
                document.getElementById('memoryUsage').textContent = `${memoryMB}MB`;
                document.getElementById('memoryUsage').className = `value ${memoryMB < 50 ? 'good' : memoryMB < 100 ? 'warning' : 'error'}`;
            }
            
            log('‚úÖ Web Vitals measured');
        }
        
        function generateRecommendations() {
            log('üí° Generating recommendations...');
            
            const recommendations = [];
            
            if (analysisResults.fullPageLoad > 5000) {
                recommendations.push('üö® Page load time exceeds 5 seconds. This is the main performance issue.');
            }
            
            if (analysisResults.backendResponse < 100) {
                recommendations.push('‚úÖ Backend performance is excellent. Focus on frontend optimization.');
            } else {
                recommendations.push('‚ö†Ô∏è Backend response time could be improved.');
            }
            
            if (analysisResults.bundleSize > 1000000) {
                recommendations.push('üì¶ JavaScript bundle is large (>1MB). Consider code splitting and lazy loading.');
            }
            
            if (analysisResults.assetCount > 100) {
                recommendations.push('üåê High number of network requests. Consider bundling and caching.');
            }
            
            if (analysisResults.slowestAsset > 2000) {
                recommendations.push('üêå Some assets are loading very slowly. Check server configuration and CDN.');
            }
            
            if (recommendations.length === 0) {
                recommendations.push('‚úÖ Performance looks good overall!');
            }
            
            // Show recommendations
            const recommendationsEl = document.getElementById('recommendations');
            const listEl = document.getElementById('recommendationsList');
            
            listEl.innerHTML = recommendations.map(rec => `<li>${rec}</li>`).join('');
            recommendationsEl.style.display = 'block';
            
            log('üìù Recommendations generated');
        }
        
        function testPageLoad() {
            log('‚è±Ô∏è Testing page navigation performance...');
            
            const testUrl = '/dashboard';
            const start = performance.now();
            
            fetch(testUrl)
                .then(response => {
                    const end = performance.now();
                    const loadTime = end - start;
                    log(`üìÑ Page load test: ${testUrl} loaded in ${loadTime.toFixed(2)}ms`);
                })
                .catch(error => {
                    log(`‚ùå Page load test failed: ${error.message}`);
                });
        }
        
        function testNetworkSpeed() {
            log('üåê Testing network speed...');
            
            // Download a small image to test network speed
            const testImage = new Image();
            const start = performance.now();
            
            testImage.onload = () => {
                const end = performance.now();
                const loadTime = end - start;
                log(`üñºÔ∏è Network speed test: Small image loaded in ${loadTime.toFixed(2)}ms`);
            };
            
            testImage.onerror = () => {
                log('‚ùå Network speed test failed');
            };
            
            testImage.src = '/favicon.ico?' + Date.now();
        }
        
        function showProgress() {
            document.getElementById('progressContainer').style.display = 'block';
        }
        
        function hideProgress() {
            setTimeout(() => {
                document.getElementById('progressContainer').style.display = 'none';
            }, 500);
        }
        
        function updateProgress(percent) {
            document.getElementById('progressBar').style.width = percent + '%';
        }
        
        function log(message) {
            const logEl = document.getElementById('analysisLog');
            const timestamp = new Date().toLocaleTimeString();
            logEl.textContent += `\n[${timestamp}] ${message}`;
            logEl.scrollTop = logEl.scrollHeight;
        }
        
        function clearResults() {
            document.getElementById('analysisLog').textContent = 'Results cleared.\n\nClick "Run Full Analysis" to start testing.';
            document.getElementById('recommendations').style.display = 'none';
            
            // Reset all metrics to loading state
            const metrics = ['domContentLoaded', 'fullPageLoad', 'firstPaint', 'firstContentfulPaint', 'largestContentfulPaint', 'bundleSize', 'backendResponse', 'assetLoading', 'totalRequests', 'failedRequests', 'vueInit', 'componentMount', 'memoryUsage'];
            metrics.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.textContent = 'Ready...';
                    el.className = 'value loading';
                }
            });
        }
        
        // Initialize performance measurement
        setTimeout(measurePerformance, 500);
    </script>
</body>
</html>